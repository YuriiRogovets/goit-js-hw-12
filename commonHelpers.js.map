{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import axios from \"axios\"\nimport iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\nconst searchForm = document.querySelector(\".search-form\");\nconst gallery = document.querySelector(\".gallery\");\nconst loaderEl = document.querySelector(\".loader\");\nconst loadMoreBtn = document.querySelector('[data-action=\"load-more\"]');\nconst messageFinishGallery = document.querySelector(\".finish-loader\")\n\nconst lightboxEl = new SimpleLightbox('.gallery a', {\n    captionsData: \"alt\",\n    captionDelay: 250,    \n});\n\nconst queryParams = {\n  query: \"\",\n  page: 1,\n  maxPage: 0,\n  pageSize: 40,\n}; \n\n    \nsearchForm.addEventListener(\"submit\", handleSerch);\nloadMoreBtn.addEventListener(\"click\", handleLoadMore);\n\nasync function handleSerch(event) {\n    event.preventDefault();\n    loaderEl.style.display = \"block\";\n    loadMoreBtn.classList.add(\"is-hidden\"); //прибираємо кнопку loadMore\n    messageFinishGallery.classList.add(\"is-hidden\"); \n    \n    gallery.innerHTML = \"\";\n\n    const form = event.currentTarget;\n    queryParams.query = form.elements.query.value.trim();\n    queryParams.page = 1;\n    \n    if (!queryParams.query) {\n    loaderEl.style.display = \"none\"; \n    return iziToast.error({\n                    message: \"Enter a query value, please\",\n                    position: \"topRight\",\n                    backgroundColor: \"green\",\n                    icon: \"none\",\n                });\n    }\n\n    try {\n        const resp = await fetchImages(queryParams.query);\n        if (resp.data.hits.length === 0) {\n                \n                return iziToast.error({\n                    message: \"Sorry, there are no images matching your search query. Please try again!\",\n                    position: \"topRight\",\n                    backgroundColor: \"red\",\n                    icon: \"none\",\n                });\n                \n                \n        } else {\n            createMarkup(resp.data.hits); // розмітка\n            \n            queryParams.maxPage = Math.ceil(resp.data.totalHits / queryParams.pageSize);      \n           // рахуємо і записуємо в обʼєкт максимальну кількість сторінок в нашому запиті\n        }    \n        \n        \n        if (queryParams.page === queryParams.maxPage) {\n\n            messageFinishGallery.classList.remove(\"is-hidden\"); // виводимо повідовлення про кінець галереї\n\n             loadMoreBtn.classList.add(\"is-hidden\"); // ховаємо кнопку loadMore\n        } else {\n\n            loadMoreBtn.classList.remove(\"is-hidden\"); //показуємо кнопку loadMore\n        }\n\n        form.reset(); // скидуємо поля форми\n\n    } catch (err) {\n        iziToast.error({\n            message: \"Oops, server connection error!\",\n            position: \"topRight\",\n            backgroundColor: \"red\",\n            icon: \"none\",\n                });\n    } finally {\n        \n        loaderEl.style.display = \"none\";\n        \n    }\n   \n}\n\n function fetchImages(query) {\n\n    const BASE_URL = \"https://pixabay.com/api\";\n    const API_KEY = \"41900218-778e908913d1efd90b8f97d56\"\n\n    const searchParams = new URLSearchParams({\n    key: API_KEY,\n    q: query,\n    image_type: \"photo\",\n    orientation: \"horizontal\",\n    safesearch: \"true\",\n    per_page: queryParams.pageSize,\n    page: queryParams.page,\n    })\n     \n        //  робимо запит\n     return axios.get(`${BASE_URL}/?${searchParams}`);\n    \n}\n\nasync function handleLoadMore(event) {\n    queryParams.page += 1; // збільшуємо номер сторінки\n    // перед початком запиту - показуємо лоадер і ховаємо кнопку\n    loaderEl.style.display = \"block\"\n    loadMoreBtn.classList.add(\"is-hidden\"); \n\n    try {\n        const respNext = await fetchImages(queryParams.query);// робимо запит на наступну сторінку\n        \n        createMarkup(respNext.data.hits);//малюємо розмітку\n\n        if (queryParams.page === queryParams.maxPage) {\n\n            loadMoreBtn.classList.add(\"is-hidden\");\n\n            messageFinishGallery.classList.remove(\"is-hidden\");\n\n        } else {\n            loadMoreBtn.classList.remove(\"is-hidden\");\n\n            const galleryCard = document.querySelector(\".gallery-card\").getBoundingClientRect();\n        \n            window.scrollBy(0, galleryCard.height * 2);\n        }\n\n    } catch (err) {\n        iziToast.error({\n            message: \"Oops, server connection error!\",\n            position: \"topRight\",\n            backgroundColor: \"red\",\n            icon: \"none\",\n                });\n    } finally {\n        \n        loaderEl.style.display = \"none\";        \n        \n    }\n     \n}\n\nfunction createMarkup(arr) {\n    const markup = arr.map(({ largeImageURL, webformatURL, tags, likes, views, comments, downloads }) =>     \n    `<li class=\"gallery-card\">\n        <a class=\"gallery-link\" href=\"${largeImageURL}\">\n            <img \n                class=\"gallery-image\"\n                    src=\"${webformatURL}\"\n                    alt=\"${tags}\"/>\n        </a>\n        \n        <div class=\"titles-box\">\n            <div class=\"title-element\">\n                <p class=\"title-text\">Likes:</p>\n                <p class=\"title-value\">${likes} </p>\n            </div>\n            <div class=\"title-element\">\n                <p class=\"title-text\">Views:</p>\n                <p class=\"title-value\">${views} </p>\n            </div>\n            <div class=\"title-element\">\n                <p class=\"title-text\">Comments:</p>\n                <p class=\"title-value\">${comments} </p>\n            </div>\n            <div class=\"title-element\">\n                <p class=\"title-text\">Downloads:</p>\n                <p class=\"title-value\">${downloads} </p>\n            </div>\n        </div>\n    </li>`\n    ).join(\"\");\n\n    gallery.insertAdjacentHTML (\"beforeend\", markup);\n\n    lightboxEl.refresh();\n}\n\n\n"],"names":["searchForm","gallery","loaderEl","loadMoreBtn","messageFinishGallery","lightboxEl","SimpleLightbox","queryParams","handleSerch","handleLoadMore","event","form","iziToast","resp","fetchImages","createMarkup","query","BASE_URL","API_KEY","searchParams","axios","respNext","galleryCard","arr","markup","largeImageURL","webformatURL","tags","likes","views","comments","downloads"],"mappings":"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"}