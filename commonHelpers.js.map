{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import axios from \"axios\"\n\nimport iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\nconst searchForm = document.querySelector(\".search-form\");\nconst gallery = document.querySelector(\".gallery\");\nconst loaderEl = document.querySelector(\".loader\");\nconst loadMoreBtn = document.querySelector('[data-action=\"load-more\"]');\nconst messageFinishGallery = document.querySelector(\".finish-loader\")\n\n\nconst lightboxEl = new SimpleLightbox('.gallery a', {\n    captionsData: \"alt\",\n    captionDelay: 250,    \n});\n\nconst queryParams = {\n  query: \"\",\n  page: 1,\n  maxPage: 0,\n  pageSize: 40,\n}; \n\nsearchForm.addEventListener(\"submit\", handleSerch);\nloadMoreBtn.addEventListener(\"click\", handleLoadMore);\n\n\nasync function handleSerch(event) {\n    event.preventDefault();\n    loaderEl.style.display = \"block\";\n    gallery.innerHTML = \"\";\n\n    const form = event.currentTarget;\n    queryParams.query = form.elements.query.value.trim();\n    \n    \n    if (!queryParams.query) {\n    loaderEl.style.display = \"none\"; \n    return \n    }\n\n    try {\n        const resp = await fetchImages(queryParams.query);\n        if (resp.data.hits.length === 0) {\n                iziToast.error({\n                    message: \"Sorry, there are no images matching your search query. Please try again!\",\n                    position: \"topRight\",\n                    backgroundColor: \"red\",\n                    icon: \"none\",\n                });\n            }\n        createMarkup(resp.data.hits);\n        \n        // console.log(resp.data);\n        // console.log(\"Ура заработало!\");\n        // console.log(resp.data.total);\n        queryParams.maxPage = Math.ceil(resp.data.total / queryParams.pageSize); \n        \n        // рахуємо і записуємо в обʼєкт максимальну кількість сторінок в нашому запиті, для цього ділимо кількість результатів на кількість обʼєктів, які ми отримуємо за один запит + округляємо догори\n\n    } catch (err) {\n        iziToast.error({\n            message: \"Oops, server connection error!\",\n            position: \"topRight\",\n            backgroundColor: \"red\",\n            icon: \"none\",\n                });\n    } finally {\n        \n        if (queryParams.page === queryParams.maxPage) {\n\n            messageFinishGallery.classList.remove(\"is-hidden\"); // виводимо повідовлення про кінець галереї\n\n        } else {\n\n            loadMoreBtn.classList.remove(\"is-hidden\"); //показуємо кнопку  load More\n        }\n\n        form.reset(); // зкидуємо поля форми\n        loaderEl.style.display = \"none\";\n        \n    }\n}\n\nasync function fetchImages(query) {\n\n    const BASE_URL = \"https://pixabay.com/api\";\n    const API_KEY = \"41900218-778e908913d1efd90b8f97d56\"\n\n    const searchParams = new URLSearchParams({\n    key: API_KEY,\n    q: query,\n    image_type: \"photo\",\n    orientation: \"horizontal\",\n    safesearch: \"true\",\n    per_page: queryParams.pageSize,\n    page: queryParams.page,\n    })\n     \n    // const responce = await axios.get(`${BASE_URL}/?${searchParams}`);\n    // console.log(responce);\n\n    //  робимо запит\n     return axios.get(`${BASE_URL}/?${searchParams}`);\n    \n}\n\nasync function handleLoadMore(event) {\n  queryParams.page += 1; // збільшуємо номер сторінки\n    // перед початком запиту - показуємо лоадер і блокуємо кнопку\n    loaderEl.style.display = \"block\"\n    loadMoreBtn.disabled = true;\n    loadMoreBtn.classList.add(\"is-hidden\"); //можна або морозити або ховати\n\n  try {\n      const respNext = await fetchImages(queryParams.query);\n      // робимо запит на наступну сторінку новин\n      \n     createMarkup(respNext.data.hits);//малюємо розмітку\n  } catch (err) {\n    console.log(err);\n  } finally {\n      \n      // після запиту - ховаємо лоадер і розблоковуємо/показуємо кнопку\n      loaderEl.style.display = \"none\";\n      loadMoreBtn.disabled = false;\n      loadMoreBtn.classList.remove(\"is-hidden\");\n    // buttonService.enable(refs.loadMoreBtn, refs.preloader);\n\n    // після натискання на кнопку та закінчення запиту перевіряємо, якщо ми зараз знаходимось на останній сторінці - то ховаємо кнопку, видаляємо обробник подій і додаємо повідомлення\n    if (queryParams.page === queryParams.maxPage) {\n        loadMoreBtn.classList.add(\"is-hidden\");\n        loadMoreBtn.removeEventListener(\"click\", handleLoadMore);\n        messageFinishGallery.classList.remove(\"is-hidden\");\n        \n    }\n  }\n}\n\n\n\nfunction createMarkup(arr) {\n    const markup = arr.map(({ largeImageURL, webformatURL, tags, likes, views, comments, downloads }) =>     \n    `<li class=\"gallery-card\">\n        <a class=\"gallery-link\" href=\"${largeImageURL}\">\n            <img \n                class=\"gallery-image\"\n                    src=\"${webformatURL}\"\n                    alt=\"${tags}\"/>\n        </a>\n        \n        <div class=\"titles-box\">\n            <div class=\"title-element\">\n                <p class=\"title-text\">Likes:</p>\n                <p class=\"title-value\">${likes} </p>\n            </div>\n            <div class=\"title-element\">\n                <p class=\"title-text\">Views:</p>\n                <p class=\"title-value\">${views} </p>\n            </div>\n            <div class=\"title-element\">\n                <p class=\"title-text\">Comments:</p>\n                <p class=\"title-value\">${comments} </p>\n            </div>\n            <div class=\"title-element\">\n                <p class=\"title-text\">Downloads:</p>\n                <p class=\"title-value\">${downloads} </p>\n            </div>\n        </div>\n    </li>`\n    ).join(\"\");\n\n    gallery.insertAdjacentHTML (\"beforeend\", markup);\n\n    lightboxEl.refresh();\n}\n\n\n"],"names":["searchForm","gallery","loaderEl","loadMoreBtn","messageFinishGallery","lightboxEl","SimpleLightbox","queryParams","handleSerch","handleLoadMore","event","form","resp","fetchImages","iziToast","createMarkup","query","BASE_URL","API_KEY","searchParams","axios","respNext","err","arr","markup","largeImageURL","webformatURL","tags","likes","views","comments","downloads"],"mappings":"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"}